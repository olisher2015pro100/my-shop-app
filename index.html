// Находим функцию sendOrder и заменяем её полностью
function sendOrder() {
    // Собираем все данные из полей ввода
    const orderData = {
        action: 'create_payment', // Маркер для бота, что нужно создать ссылку
        customer: $('#f_name').val(),
        phone: $('#f_phone').val(),
        address: $('#f_addr').val(),
        zip: $('#f_zip').val(),
        item: $('#p-title').text(),
        // Убираем лишние слова, оставляем только число для платежки
        total: $('#final-sum').text().replace(/[^0-9]/g, '') 
    };

    // Простая проверка: если поля пустые, не отправляем
    if (!orderData.customer || !orderData.phone || !orderData.address) {
        alert("Пожалуйста, заполните все данные для доставки");
        return;
    }

    // Отправляем данные в Telegram бот
    tg.sendData(JSON.stringify(orderData));
    
    // Закрываем Mini App, чтобы пользователь увидел сообщение от бота с кнопкой оплаты
    tg.close();
}

// Также обнови обработчик отправки формы, чтобы он сразу вызывал sendOrder
$('#order-form').on('submit', function(e) { 
    e.preventDefault(); 
    sendOrder(); 
});